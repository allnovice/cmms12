# addUser2.js â€“ Create users and send password setup emails via Gmail OAuth2

Creates Firebase Auth users (if missing) and emails them a password-reset link. Supports single email or bulk CSV. Requires a Gmail OAuth2 token generated via `autorize2.js`.

## Requirements
- Node.js
- `.env.local` with `GMAIL_SENDER`
- Service account JSON at `../serviceAccountKey.json` (relative to `scrpt/`)
- Gmail OAuth2 token at `scrpt/token.json` (generated by `autorize2.js`)
- Google client credentials at `creds.json` (or merged into `token.json`)
- For CSV: header containing `email` (case-insensitive)

## Setup (one-time)
1) Run `autorize2.js` to generate `token.json`:
```bash
node autorize2.js
```
- Follow the printed URL, approve with the sender account, paste the code, and `token.json` is saved in `scrpt/`.

2) Ensure `.env.local` has:
```
GMAIL_SENDER=your_account@gmail.com
```

3) Place `creds.json` (Google OAuth client) one level up from `scrpt/`, or merge its `client_id` and `client_secret` into `token.json`.

## Usage
From `scrpt/`:

### Single email
```bash
node addUser2.js user@example.com
```
- If the user exists, it reuses the account; otherwise creates it.
- Sends a password reset link to the email.

### Bulk CSV
```bash
node addUser2.js users.csv
```
- Reads `email` column (case-insensitive). Sends to each row found.

## Behavior
- Creates Firebase Auth user if missing; logs if it already exists.
- Generates a password reset link and emails it via Gmail OAuth2.
- Email sender: `GMAIL_SENDER` from `.env.local`.
- Exits if `token.json` or `GMAIL_SENDER` is missing.

### Alternative: Firebase Console
- You can also add users directly in Firebase Console > Authentication > Users. This script is for bulk/automated onboarding with email sends.

## Common issues
- Missing `token.json`: run `node autorize2.js`.
- Missing client credentials: ensure `creds.json` exists or embed `client_id/client_secret` into `token.json`.
- Gmail sender mismatch: the authorized Google account must match `GMAIL_SENDER`.
- CSV missing `email` column: add it or rename header to `email` (any casing works).
- Permission errors: ensure the service account can create Firebase Auth users.
